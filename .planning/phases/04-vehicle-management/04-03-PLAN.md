---
phase: 04-vehicle-management
plan: 03
type: execute
depends_on: ["04-01", "04-02"]
files_modified: [src/app/vehicles/page.tsx, src/app/vehicles/new/page.tsx, src/app/vehicles/[id]/page.tsx, src/app/vehicles/[id]/edit/page.tsx, src/components/AuthStatus.tsx]
---

<objective>
Create vehicle management UI pages for listing, adding, viewing, and editing vehicles.

Purpose: Complete the vehicle management feature with user-facing interface for all CRUD operations.
Output: Working UI pages for vehicle management with photo upload support.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./04-03-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-vehicle-management/04-01-SUMMARY.md
@.planning/phases/04-vehicle-management/04-02-SUMMARY.md
@src/app/groups/page.tsx
@src/app/groups/new/page.tsx
@src/components/AuthStatus.tsx

**Established UI patterns (from Phase 3):**
- 'use client' for interactive pages
- useSession from next-auth/react
- Redirect unauthenticated to /login
- Loading state shows "Loading..."
- Forms with controlled inputs, error state, isLoading
- Mobile-first Tailwind with dark mode support
- Back links to parent page
- Success states with confirmation messaging
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create vehicle list and add pages</name>
  <files>src/app/vehicles/page.tsx, src/app/vehicles/new/page.tsx</files>
  <action>
Create /vehicles page (list):
- Fetch GET /api/vehicles on mount
- Display vehicles as cards showing: photo (or placeholder), name, year make model, group name
- "Add Vehicle" button links to /vehicles/new
- Click vehicle card navigates to /vehicles/[id]
- Empty state: "No vehicles yet. Add your first vehicle to start tracking fuel."
- Mobile-first grid: 1 column on mobile, 2 on tablet, 3 on desktop

Create /vehicles/new page (add form):
- Form fields: name, year, make, model, tankSize (optional), fuelType (dropdown), groupId (dropdown of user's groups), photo (file input)
- Fetch user's groups to populate groupId dropdown
- Photo upload: show preview after selection, upload to /api/vehicles/[id]/photo after vehicle created
- Flow: Create vehicle (POST /api/vehicles) -> If photo selected, upload photo -> Navigate to /vehicles/[id]
- Validation: All required fields, year 1900-2100
- Cancel button returns to /vehicles
- Style consistent with /groups/new page
  </action>
  <verify>
/vehicles page loads and shows vehicles (or empty state)
/vehicles/new form submits and creates vehicle
Photo uploads after vehicle creation
Redirects to vehicle detail page on success
  </verify>
  <done>Vehicle list shows all user's vehicles with photos, add form creates vehicle with optional photo</done>
</task>

<task type="auto">
  <name>Task 2: Create vehicle detail and edit pages</name>
  <files>src/app/vehicles/[id]/page.tsx, src/app/vehicles/[id]/edit/page.tsx</files>
  <action>
Create /vehicles/[id] page (detail view):
- Fetch GET /api/vehicles/[id] on mount
- Display: large photo (or placeholder), name, year make model, tank size, fuel type, group name
- "Edit" button links to /vehicles/[id]/edit
- "Delete" button with confirmation dialog
- Delete calls DELETE /api/vehicles/[id], then redirects to /vehicles
- Back link to /vehicles

Create /vehicles/[id]/edit page:
- Pre-populate form with existing vehicle data
- Same fields as new page but groupId is read-only (can't change group after creation)
- Photo section: show current photo with "Change Photo" and "Remove Photo" buttons
- Change Photo: file input, uploads immediately via POST /api/vehicles/[id]/photo, shows new preview
- Remove Photo: calls DELETE /api/vehicles/[id]/photo, removes preview
- Save button: PATCH /api/vehicles/[id] with changed fields
- Cancel button: returns to /vehicles/[id] without saving
- Success: redirect to /vehicles/[id]
  </action>
  <verify>
/vehicles/[id] displays vehicle details with photo
Edit link works
Delete with confirmation works
/vehicles/[id]/edit pre-populates form
Photo change uploads immediately
Save updates vehicle
  </verify>
  <done>Detail page shows full vehicle info, edit page updates all fields and handles photo changes</done>
</task>

<task type="auto">
  <name>Task 3: Update home page with vehicles section</name>
  <files>src/components/AuthStatus.tsx</files>
  <action>
Add vehicles section to AuthStatus component (similar to groups section):
- Fetch /api/vehicles on mount (alongside groups)
- "Your Vehicles" heading with "Manage" link to /vehicles
- Show first 3-4 vehicles with photo thumbnail, name, year make model
- If more vehicles, show "+N more" link to /vehicles
- Empty state: "Add your first vehicle" link to /vehicles/new
- Section appears after groups section
  </action>
  <verify>
Home page shows vehicles section
Vehicles display with thumbnails
"Manage" link goes to /vehicles
Empty state shows when no vehicles
  </verify>
  <done>Home page dashboard includes vehicles section with quick view of user's vehicles</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] /vehicles lists all vehicles with photos
- [ ] /vehicles/new creates vehicle with photo
- [ ] /vehicles/[id] shows full details
- [ ] /vehicles/[id]/edit updates vehicle and photo
- [ ] Delete works with confirmation
- [ ] Home page shows vehicles section
- [ ] All pages have mobile-first styling with dark mode
</verification>

<success_criteria>

- All vehicle CRUD operations available via UI
- Photo upload/change/remove works smoothly
- Consistent styling with existing pages
- Home page shows vehicles dashboard
- Phase 4 complete
</success_criteria>

<output>
After completion, create `.planning/phases/04-vehicle-management/04-03-SUMMARY.md`

Include "Phase 4 complete" section noting:
- Vehicle model with full CRUD
- Photo upload with local storage
- Complete UI for vehicle management
- Home page dashboard updated
</output>
