---
phase: 11-pwa-offline
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/contexts/OfflineContext.tsx
  - src/hooks/useNetworkStatus.ts
  - src/components/ConnectionToast.tsx
  - src/components/OfflineIndicator.tsx
  - src/components/Providers.tsx
autonomous: true

must_haves:
  truths:
    - "User sees toast when going offline"
    - "User sees toast when coming back online"
    - "User sees persistent offline indicator when offline"
    - "Offline state is accessible throughout app via context"
  artifacts:
    - path: "src/contexts/OfflineContext.tsx"
      provides: "Offline state context provider"
      exports: ["OfflineProvider", "useOffline"]
    - path: "src/hooks/useNetworkStatus.ts"
      provides: "Network detection hook"
      exports: ["useNetworkStatus"]
    - path: "src/components/ConnectionToast.tsx"
      provides: "Toast for connection changes"
      exports: ["ConnectionToast"]
    - path: "src/components/OfflineIndicator.tsx"
      provides: "Persistent offline status indicator"
      exports: ["OfflineIndicator"]
  key_links:
    - from: "src/contexts/OfflineContext.tsx"
      to: "src/hooks/useNetworkStatus.ts"
      via: "hook usage"
      pattern: "useNetworkStatus"
    - from: "src/components/Providers.tsx"
      to: "src/contexts/OfflineContext.tsx"
      via: "provider nesting"
      pattern: "OfflineProvider"
---

<objective>
Create offline context and connection status UI components

Purpose: Provide centralized offline state management and user-facing indicators for connection status changes. Users need to know when they're offline and when they come back online.

Output: OfflineContext for app-wide offline state, toast notifications for connection changes, persistent offline indicator
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-pwa-offline/11-CONTEXT.md
@.planning/phases/11-pwa-offline/11-RESEARCH.md

# Key existing files
@src/hooks/useOfflineQueue.ts
@src/components/Providers.tsx
@src/contexts/ThemeContext.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useNetworkStatus hook and OfflineContext</name>
  <files>src/hooks/useNetworkStatus.ts, src/contexts/OfflineContext.tsx</files>
  <action>
Create useNetworkStatus hook (src/hooks/useNetworkStatus.ts):
- Track navigator.onLine state
- Listen to 'online' and 'offline' window events
- Return { isOnline: boolean, wasOffline: boolean }
- wasOffline tracks if user was previously offline (for "back online" detection)

Create OfflineContext (src/contexts/OfflineContext.tsx):
- Uses useNetworkStatus internally
- Provides { isOnline, wasOffline, pendingCount, isSyncing } to children
- pendingCount and isSyncing will be wired to sync engine in Plan 11-03 (for now, default to 0 and false)
- Export OfflineProvider and useOffline hook

Pattern after existing ThemeContext for consistency.
  </action>
  <verify>Files exist and export correctly: useNetworkStatus, OfflineProvider, useOffline</verify>
  <done>Network status hook and offline context created with proper exports</done>
</task>

<task type="auto">
  <name>Task 2: Create ConnectionToast and OfflineIndicator components</name>
  <files>src/components/ConnectionToast.tsx, src/components/OfflineIndicator.tsx</files>
  <action>
Create ConnectionToast (src/components/ConnectionToast.tsx):
- Uses useOffline context
- Shows toast notification when connection status changes:
  - Going offline: "You're offline" (amber/warning color)
  - Coming online: "Back online" (green/success color)
- Toast auto-dismisses after 3 seconds
- Position: fixed bottom-20 (above bottom nav on mobile)
- Use animate-fade-in-up class if available, or add simple transition

Create OfflineIndicator (src/components/OfflineIndicator.tsx):
- Uses useOffline context
- Only renders when isOnline=false
- Small persistent badge/pill in top-right corner or header area
- Text: "Offline" with cloud-off icon
- Amber/yellow styling to indicate warning state
- Does NOT auto-dismiss (stays until online)

Both components should use dark mode classes.
  </action>
  <verify>Components exist and export correctly</verify>
  <done>ConnectionToast shows on status change, OfflineIndicator shows when offline</done>
</task>

<task type="auto">
  <name>Task 3: Wire OfflineProvider and components into app</name>
  <files>src/components/Providers.tsx</files>
  <action>
Update Providers.tsx to include OfflineProvider:
1. Import OfflineProvider from contexts/OfflineContext
2. Import ConnectionToast and OfflineIndicator from components
3. Wrap children with OfflineProvider (inside ThemeProvider)
4. Add ConnectionToast and OfflineIndicator components inside the provider

Order of providers should be:
SessionProvider > ThemeProvider > OfflineProvider > children

Add the UI components at the end of the provider tree so they render on top.
  </action>
  <verify>Run `npm run build` - no errors. Test by toggling network in DevTools - toasts appear</verify>
  <done>OfflineProvider wraps app, ConnectionToast and OfflineIndicator render globally</done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build`
2. Open app in browser
3. Open DevTools > Network tab > toggle "Offline"
4. Going offline: see "You're offline" toast + persistent "Offline" indicator
5. Going online: see "Back online" toast, indicator disappears
</verification>

<success_criteria>
- OfflineContext provides isOnline state throughout app
- Toast appears on connection status changes
- Persistent offline indicator visible when offline
- Components styled for both light and dark themes
</success_criteria>

<output>
After completion, create `.planning/phases/11-pwa-offline/11-02-SUMMARY.md`
</output>
