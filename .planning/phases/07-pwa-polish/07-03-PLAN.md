---
phase: 07-pwa-polish
plan: 03
type: execute
depends_on: ["07-02"]
files_modified: [src/components/InstallPrompt.tsx, src/app/layout.tsx, src/components/BottomNav.tsx, src/app/dashboard/page.tsx]
---

<objective>
Polish mobile UI and add install prompts for PWA experience.

Purpose: Make the app feel native on mobile with proper install flow.
Output: Install prompts, bottom navigation, viewport handling, native-like UX.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-pwa-polish/07-02-SUMMARY.md
@src/app/layout.tsx
@src/app/dashboard/page.tsx
@src/components/AuthStatus.tsx

**Tech stack available:** Next.js 16, React 19, Tailwind 4, Serwist PWA
**Established patterns:** Dark mode (#0f172a slate), mobile-first, large tap targets
**Constraining decisions:** Mobile-first PWA, quick fillup entry is core value

**Prior decisions:**
- Dashboard is primary landing for authenticated users
- "Log Fillup" is the primary action
- Dark theme throughout
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PWA install prompt component</name>
  <files>src/components/InstallPrompt.tsx, src/hooks/useInstallPrompt.ts</files>
  <action>
    1. Create src/hooks/useInstallPrompt.ts:
       - Listen for 'beforeinstallprompt' event
       - Store the event for later use
       - Track if app is already installed (display-mode: standalone check)
       - Return: { canInstall, isInstalled, promptInstall }
    2. Create src/components/InstallPrompt.tsx:
       - Show banner when canInstall is true and not dismissed
       - Design: Subtle banner at bottom of screen (not intrusive)
       - Text: "Install Fuel Tracker for quick access at the pump"
       - Actions: "Install" button (primary), "Not now" dismiss
       - Store dismissal in localStorage (don't show again for 7 days)
       - On install success: show brief "Added to home screen" toast
    3. Style to match app theme:
       - Dark background (#1e293b slate-800)
       - White text, green install button
       - Rounded corners, subtle shadow

    AVOID: Don't show prompt on first visit (wait for engagement). Don't be pushy.
  </action>
  <verify>Component renders without errors, banner appears on supported browsers</verify>
  <done>Install prompt shows for eligible users, respects dismissal, handles install flow</done>
</task>

<task type="auto">
  <name>Task 2: Add mobile bottom navigation</name>
  <files>src/components/BottomNav.tsx, src/app/layout.tsx</files>
  <action>
    1. Create src/components/BottomNav.tsx:
       - Fixed bottom navigation bar (only shows on mobile, standalone mode)
       - 4 items: Dashboard (home icon), Vehicles (car icon), Add Fillup (+ icon, prominent), Profile (user icon)
       - Add Fillup button: Larger, centered, accent color (green)
       - Active state: Filled icon, text label visible
       - Inactive state: Outline icon, smaller
       - Safe area padding for iPhone notch (env(safe-area-inset-bottom))
    2. Update src/app/layout.tsx:
       - Include BottomNav component
       - Only render on client (use 'use client' wrapper or dynamic import)
       - Hide on desktop (md:hidden)
       - Add padding-bottom to main content to account for nav height
    3. Style guidelines:
       - Background: #0f172a (slate-900)
       - Border-top: 1px #334155 (slate-700)
       - Icons: Use inline SVGs or heroicons (already likely in use)
       - Height: 64px + safe area

    AVOID: Don't show on desktop. Don't use absolute positioning that breaks scroll.
  </action>
  <verify>Bottom nav appears on mobile viewport, navigation works, doesn't overlap content</verify>
  <done>Bottom navigation with quick fillup action, mobile-only, safe area handling</done>
</task>

<task type="auto">
  <name>Task 3: Polish viewport and standalone mode handling</name>
  <files>src/app/layout.tsx, src/app/dashboard/page.tsx, src/components/InstallPrompt.tsx</files>
  <action>
    1. Update src/app/layout.tsx viewport and meta:
       - viewport: "width=device-width, initial-scale=1, viewport-fit=cover"
       - theme-color meta tag matching app theme
       - apple-mobile-web-app-capable: yes
       - apple-mobile-web-app-status-bar-style: black-translucent
       - Add safe area padding CSS custom properties
    2. Add standalone mode detection:
       - Create useStandaloneMode hook or inline check
       - Check: window.matchMedia('(display-mode: standalone)').matches
       - Or: window.navigator.standalone (iOS Safari)
    3. Conditional UI adjustments for standalone:
       - Hide install prompt when already installed
       - Adjust header padding for status bar
       - Potentially hide browser-specific elements
    4. Add to dashboard InstallPrompt component:
       - Show after user has visited 2+ times (engagement check)
       - Position above bottom nav if both visible

    AVOID: Don't break regular browser experience. Don't assume standalone mode.
  </action>
  <verify>App looks correct in standalone mode (add to home screen test), viewport handles notches</verify>
  <done>Proper standalone mode handling, viewport fit for all devices, install prompt integrated</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] Install prompt appears on eligible browsers (Chrome mobile)
- [ ] Bottom nav shows on mobile, hidden on desktop
- [ ] Safe area handling works (test with iPhone notch simulator)
- [ ] Standalone mode displays correctly when installed
- [ ] Quick fillup button is prominent and accessible
</verification>

<success_criteria>
- PWA install flow works end-to-end
- Mobile navigation is thumb-friendly with prominent Add Fillup
- App feels native when installed (no browser chrome)
- Viewport handles all device types including notched phones
- Phase 7 complete - full PWA experience
</success_criteria>

<output>
After completion, create `.planning/phases/07-pwa-polish/07-03-SUMMARY.md`

This completes Phase 7 and the current milestone.
</output>
