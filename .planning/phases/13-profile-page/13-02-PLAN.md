---
phase: 13-profile-page
plan: 02
type: execute
wave: 2
depends_on: ["13-01"]
files_modified:
  - src/app/profile/page.tsx
autonomous: false

must_haves:
  truths:
    - "User can see their email address (read-only)"
    - "User can edit their display name"
    - "User can select theme preference (light/dark/system)"
    - "User can change their password"
    - "Form shows loading/success/error states"
  artifacts:
    - path: "src/app/profile/page.tsx"
      provides: "Full profile management UI"
      min_lines: 200
  key_links:
    - from: "src/app/profile/page.tsx"
      to: "/api/user/profile"
      via: "fetch in profile form"
      pattern: "fetch.*api/user/profile"
    - from: "src/app/profile/page.tsx"
      to: "/api/user/password"
      via: "fetch in password form"
      pattern: "fetch.*api/user/password"
    - from: "src/app/profile/page.tsx"
      to: "useTheme"
      via: "theme selector"
      pattern: "useTheme|setTheme"
---

<objective>
Enhance the profile page with editable name, theme selector, and password change form.

Purpose: Give users control over their profile settings, theme preference, and security.
Output: Fully functional profile page with working forms and theme selection.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-profile-page/13-01-SUMMARY.md

# Current profile page
@src/app/profile/page.tsx

# Theme context
@src/contexts/ThemeContext.tsx

# Design patterns
@src/components/BottomNav.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add profile edit section with name field</name>
  <files>src/app/profile/page.tsx</files>
  <action>
Replace the static "Account" section with an editable profile form:

**State:**
- `name`: string (initialized from session.user.name or empty)
- `isEditing`: boolean (toggle edit mode)
- `isSaving`: boolean (loading state)
- `saveError`: string | null
- `saveSuccess`: boolean (briefly show success message)

**Display mode (isEditing = false):**
- Show email (read-only, styled as label + value)
- Show name (read-only, styled as label + value)
- "Edit" button that sets isEditing = true

**Edit mode (isEditing = true):**
- Show email (read-only)
- Input field for name (prefilled with current value)
- "Save" button (disabled while isSaving)
- "Cancel" button that resets to display mode

**Save action:**
- Set isSaving = true
- PATCH /api/user/profile with { name }
- On success: update local state, set isEditing = false, briefly show success
- On error: set saveError with error message

Remove the "Account management coming soon" placeholder text.
  </action>
  <verify>
```bash
npm run build
```
Visit /profile, verify edit button appears, click to edit, save changes.
  </verify>
  <done>Profile section shows name/email, allows editing name with save/cancel</done>
</task>

<task type="auto">
  <name>Task 2: Add theme selector in preferences section</name>
  <files>src/app/profile/page.tsx</files>
  <action>
Replace the current Preferences section with an actual theme selector:

**Import:**
- `useTheme` from `@/contexts/ThemeContext`

**Theme selector UI:**
- Three-button toggle group: Light | Dark | System
- Highlight current selection with bg-blue-500 text-white (or appropriate dark mode variant)
- Non-selected buttons: bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-100
- On click, call setTheme() with the selected value

**Layout:**
- Label: "Theme"
- Sublabel: "Choose your preferred appearance"
- Button group below (horizontal row, rounded corners, no gaps between buttons)

Remove the "Use the theme button in the navigation bar" text since we're adding the selector here.
  </action>
  <verify>
```bash
npm run build
```
Visit /profile, click each theme button, verify theme changes immediately.
  </verify>
  <done>Theme selector shows current preference and allows switching between light/dark/system</done>
</task>

<task type="auto">
  <name>Task 3: Add password change section</name>
  <files>src/app/profile/page.tsx</files>
  <action>
Add a new "Security" section below Preferences with password change form:

**State:**
- `currentPassword`: string
- `newPassword`: string
- `confirmPassword`: string
- `isChangingPassword`: boolean (loading state)
- `passwordError`: string | null
- `passwordSuccess`: boolean

**Form fields:**
- Current Password (type="password", required)
- New Password (type="password", required, min 8 chars)
- Confirm New Password (type="password", required)

**Validation (client-side):**
- All fields required
- New password >= 8 characters
- New password matches confirm password

**Submit action:**
- Set isChangingPassword = true
- POST /api/user/password with { currentPassword, newPassword }
- On success: clear all password fields, show success message
- On error: set passwordError with error message from API

**UI considerations:**
- "Change Password" button (disabled while isChangingPassword or validation fails)
- Show validation errors inline below each field
- Show API error at form level
- Success message: "Password changed successfully" (auto-clear after 3 seconds)
  </action>
  <verify>
```bash
npm run build
```
Visit /profile, fill out password form, test validation, test successful change.
  </verify>
  <done>Password change form validates input, calls API, shows appropriate feedback</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete profile page with editable name, theme selector, and password change</what-built>
  <how-to-verify>
1. Navigate to /profile
2. **Profile section:**
   - Verify email displays (read-only)
   - Click Edit, change name, click Save
   - Verify name updates and persists after page refresh
3. **Theme section:**
   - Click each theme button (Light, Dark, System)
   - Verify theme changes immediately
   - Refresh page, verify selection persisted
4. **Password section:**
   - Test validation: leave fields empty, mismatched passwords, short password
   - Test with wrong current password (should show error)
   - Test with correct current password (should show success)
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues found</resume-signal>
</task>

</tasks>

<verification>
- `npm run build` completes without errors
- Profile page renders without console errors
- All three sections (Profile, Theme, Password) are functional
- Dark mode styles applied correctly across all sections
</verification>

<success_criteria>
- User can view and edit their display name
- User can select theme preference with immediate effect
- User can change password with proper validation
- All forms show appropriate loading and error states
- UI matches existing design patterns (cards, shadows, spacing)
</success_criteria>

<output>
After completion, create `.planning/phases/13-profile-page/13-02-SUMMARY.md`
</output>
