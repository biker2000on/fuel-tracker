---
phase: 05-fillup-entry
plan: 03
type: execute
depends_on: ["05-01", "05-02"]
files_modified: [src/app/fillups/new/page.tsx, src/app/vehicles/[id]/fillups/page.tsx, src/components/AuthStatus.tsx]
---

<objective>
Create fillup entry UI with optimized quick-entry experience and per-vehicle fillup list.

Purpose: Complete the core fillup entry feature with user-facing interface optimized for quick logging at the pump.
Output: Fast fillup entry form, per-vehicle fillup history, and home dashboard updates.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./05-03-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-fillup-entry/05-01-SUMMARY.md
@.planning/phases/05-fillup-entry/05-02-SUMMARY.md
@src/app/vehicles/page.tsx
@src/app/vehicles/new/page.tsx
@src/hooks/useGeolocation.ts
@src/lib/geocoding.ts
@src/components/AuthStatus.tsx

**Core value from PROJECT.md:**
"Quick fillup entry — fast, frictionless logging from the phone at the pump. If the entry flow has friction, the app fails."

**UX priorities:**
1. Vehicle selection first (large tap targets, recent vehicle at top)
2. Essential fields prominent: gallons, price, odometer
3. Location auto-detected in background, shown as confirmation
4. One-tap "Log Fillup" button at bottom
5. Mobile-first: large inputs, numeric keyboards, no scrolling to submit

**Established UI patterns (from Phase 4):**
- 'use client' for interactive pages
- useSession from next-auth/react
- Redirect unauthenticated to /login
- Loading state shows "Loading..."
- Mobile-first Tailwind with dark mode support
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create quick fillup entry form</name>
  <files>src/app/fillups/new/page.tsx</files>
  <action>
Create /fillups/new page optimized for quick entry at the pump:

**Layout (top to bottom, no scroll to submit):**
1. Header: "Log Fillup" with back link
2. Vehicle selector: Large cards/buttons for user's vehicles (photo + name), recent first
3. Core inputs (large, mobile-optimized):
   - Gallons: number input, 2 decimals, numeric keyboard
   - Price per gallon: number input with $, 3 decimals, numeric keyboard
   - Odometer: integer input, numeric keyboard
4. Location badge: Auto-detected city/state, tap to refresh or clear
5. Optional toggle: "Full tank" checkbox (default checked)
6. Optional: Notes textarea (collapsed by default, tap to expand)
7. Submit button: Large, fixed at bottom, "Log Fillup"

**Behavior:**
- Fetch vehicles on mount, auto-select if only one vehicle
- If vehicleId in URL query param, pre-select that vehicle
- Start geolocation fetch immediately on mount (parallel with vehicle fetch)
- When location ready, show badge with city/state
- Calculate total cost live as user enters gallons and price
- Show running total: "$XX.XX total"
- On submit: POST to /api/fillups with all data
- Success: Navigate to /vehicles/[vehicleId]/fillups with success toast
- Error: Show inline error, keep form state

**Input attributes for mobile:**
- inputMode="decimal" for gallons and price
- inputMode="numeric" for odometer
- autocomplete="off" to prevent autofill issues

**Date handling:**
- Default to current date/time (now)
- Allow changing via date picker if needed (small link "Change date")
  </action>
  <verify>
/fillups/new page loads
Vehicle selection works
Inputs accept proper numeric values
Location auto-detects and shows badge
Submit creates fillup
  </verify>
  <done>Quick fillup form is fast, mobile-optimized, auto-detects location, submits successfully</done>
</task>

<task type="auto">
  <name>Task 2: Create per-vehicle fillup list</name>
  <files>src/app/vehicles/[id]/fillups/page.tsx</files>
  <action>
Create /vehicles/[id]/fillups page showing fillup history for a vehicle:

**Layout:**
1. Header: Vehicle name with back link to /vehicles/[id]
2. "Add Fillup" button linking to /fillups/new?vehicleId=[id]
3. Fillup list: Cards showing each fillup
   - Date (formatted nicely: "Jan 15, 2026")
   - Gallons and total cost ("12.5 gal • $45.00")
   - MPG if available ("32.5 MPG")
   - Location if available ("Austin, TX")
4. Empty state: "No fillups yet. Log your first fillup!"
5. Summary stats at top:
   - Total fillups count
   - Average MPG (if multiple fillups)
   - Total gallons

**Data fetching:**
- GET /api/fillups?vehicleId=[id] with limit=50
- Order by date descending (most recent first)

**Card actions:**
- Tap card to see details (modal or expand)
- Edit and Delete options (confirm before delete)
  </action>
  <verify>
/vehicles/[id]/fillups page loads
Shows fillup history for correct vehicle
Empty state shows when no fillups
Stats calculate correctly
  </verify>
  <done>Fillup history page shows all fillups for vehicle with stats and CRUD options</done>
</task>

<task type="auto">
  <name>Task 3: Update home page and vehicle detail</name>
  <files>src/components/AuthStatus.tsx, src/app/vehicles/[id]/page.tsx</files>
  <action>
Update AuthStatus (home dashboard):
- Add "Recent Fillups" section after vehicles
- Fetch GET /api/fillups?limit=5 (most recent across all vehicles)
- Show fillup cards: date, vehicle name, gallons, location
- "Log Fillup" primary action button (prominent, above the fold)
- "View All" link to... (for now just /vehicles since no dedicated fillups page)

Update /vehicles/[id]/page.tsx (vehicle detail):
- Add "Fillups" section showing last 3 fillups for this vehicle
- "View All" link to /vehicles/[id]/fillups
- "Log Fillup" button linking to /fillups/new?vehicleId=[id]
- Show basic stats: total fillups, average MPG
  </action>
  <verify>
Home page shows recent fillups and Log Fillup button
Vehicle detail shows fillup summary
Links navigate correctly
  </verify>
  <done>Home dashboard has quick fillup access, vehicle detail shows fillup summary</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] /fillups/new creates fillup with location
- [ ] /vehicles/[id]/fillups lists fillups with stats
- [ ] Home page shows recent fillups and Log Fillup button
- [ ] Vehicle detail shows fillup summary
- [ ] All pages mobile-first with dark mode
- [ ] Quick entry flow is genuinely fast (no friction)
</verification>

<success_criteria>

- Fillup entry form is fast and frictionless
- Location auto-detection works seamlessly
- Per-vehicle fillup history available
- Home page provides quick fillup access
- Phase 5 complete
</success_criteria>

<output>
After completion, create `.planning/phases/05-fillup-entry/05-03-SUMMARY.md`

Include "Phase 5 complete" section noting:
- Fillup model with all tracking fields
- Location auto-detection with Nominatim
- Quick entry UX optimized for pump use
- Per-vehicle fillup history
</output>
