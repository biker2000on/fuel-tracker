---
phase: 01-foundation
plan: 02
type: execute
depends_on: ["01-01"]
files_modified: [prisma/schema.prisma, src/lib/db.ts, .env, .env.example]
---

<objective>
Set up Prisma ORM with PostgreSQL and create base database schema.

Purpose: Establish database layer with User model as foundation for auth and all features.
Output: Prisma configured, schema defined, database client ready for use.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./01-02-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Prisma with PostgreSQL</name>
  <files>prisma/schema.prisma, .env, .env.example</files>
  <action>
    Run `npm install prisma @prisma/client` to add Prisma dependencies.
    Run `npx prisma init --datasource-provider postgresql` to scaffold Prisma.

    Update .env with DATABASE_URL placeholder:
    `DATABASE_URL="postgresql://postgres:postgres@localhost:5432/fuel_tracker?schema=public"`

    Create .env.example with same structure but no real values:
    `DATABASE_URL="postgresql://user:password@host:5432/database?schema=public"`

    Add .env to .gitignore if not already present.
  </action>
  <verify>prisma/schema.prisma exists with postgresql datasource configured</verify>
  <done>Prisma initialized with PostgreSQL provider. Env files created.</done>
</task>

<task type="auto">
  <name>Task 2: Create base schema and database client</name>
  <files>prisma/schema.prisma, src/lib/db.ts</files>
  <action>
    Add User model to schema.prisma as foundation (auth will extend later):

    ```prisma
    model User {
      id        String   @id @default(cuid())
      email     String   @unique
      name      String?
      createdAt DateTime @default(now())
      updatedAt DateTime @updatedAt
    }
    ```

    Create src/lib/db.ts with singleton Prisma client pattern:

    ```typescript
    import { PrismaClient } from '@prisma/client'

    const globalForPrisma = globalThis as unknown as {
      prisma: PrismaClient | undefined
    }

    export const prisma = globalForPrisma.prisma ?? new PrismaClient()

    if (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma
    ```

    This pattern prevents connection issues in Next.js dev mode with hot reload.

    Run `npx prisma generate` to generate Prisma Client types.
  </action>
  <verify>`npx prisma validate` passes, `npx prisma generate` succeeds, TypeScript recognizes Prisma types</verify>
  <done>Schema valid with User model. Prisma client created with singleton pattern. Types generated.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx prisma validate` passes
- [ ] `npx prisma generate` succeeds
- [ ] src/lib/db.ts exports prisma client
- [ ] `npm run build` still succeeds
- [ ] .env.example exists (no secrets)
- [ ] .env is gitignored
</verification>

<success_criteria>

- Prisma installed and configured for PostgreSQL
- User model defined in schema
- Prisma client singleton created
- Types generated successfully
- Environment variables properly structured
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
