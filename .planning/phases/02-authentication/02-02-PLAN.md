---
phase: 02-authentication
plan: 02
type: execute
depends_on: ["02-01"]
files_modified: [src/app/api/auth/register/route.ts, src/app/(auth)/login/page.tsx, src/app/(auth)/register/page.tsx, src/auth.ts]
---

<objective>
Create user registration endpoint and login/registration UI flows.

Purpose: Enable users to create accounts and authenticate.
Output: Working registration API, login and register pages with forms.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./02-02-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-authentication/02-01-SUMMARY.md
@src/auth.ts
@prisma/schema.prisma
@src/lib/db.ts

**Tech stack available:**
- Auth.js v5 with credentials provider
- bcrypt for password hashing
- Prisma with User model (has passwordHash)

**Constraining decisions:**
- 02-01: JWT session strategy, no database sessions
- 02-01: Credentials provider configured
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create registration API endpoint with password hashing</name>
  <files>src/app/api/auth/register/route.ts</files>
  <action>
    Create POST /api/auth/register endpoint:

    1. Accept JSON body: { email: string, password: string, name?: string }
    2. Validate inputs:
       - email: valid format, required
       - password: min 8 chars, required
       - name: optional
    3. Check if user already exists (query by email)
       - If exists: return 409 Conflict
    4. Hash password with bcrypt (10 salt rounds)
    5. Create user in database via prisma
    6. Return 201 with { id, email, name } (never return passwordHash)

    Error responses:
    - 400: Invalid input (missing fields, invalid email, password too short)
    - 409: Email already registered
    - 500: Database error

    Use try/catch for database operations. Log errors server-side.
  </action>
  <verify>curl -X POST localhost:3000/api/auth/register with valid JSON creates user and returns 201</verify>
  <done>Registration endpoint creates users with hashed passwords, validates input, handles duplicates.</done>
</task>

<task type="auto">
  <name>Task 2: Create login and registration pages with forms</name>
  <files>src/app/(auth)/login/page.tsx, src/app/(auth)/register/page.tsx, src/app/(auth)/layout.tsx</files>
  <action>
    Create auth route group with shared layout:

    src/app/(auth)/layout.tsx:
    - Centered layout for auth pages
    - Mobile-first, clean design
    - No navigation (minimal chrome)

    src/app/(auth)/login/page.tsx:
    - Form with email and password fields
    - Submit calls signIn("credentials", { email, password, redirect: true, callbackUrl: "/" })
    - Show error message on failed login
    - Link to registration page
    - "use client" directive for form handling

    src/app/(auth)/register/page.tsx:
    - Form with name (optional), email, password, confirm password fields
    - Client-side validation: passwords match, min 8 chars
    - Submit POSTs to /api/auth/register
    - On success: auto-login via signIn("credentials") and redirect to home
    - Show error messages (duplicate email, validation errors)
    - Link to login page
    - "use client" directive

    Styling: Use Tailwind. Mobile-first. Clean, minimal.
    Keep forms simple - no fancy animations or third-party form libraries.

    Import signIn from "next-auth/react".
  </action>
  <verify>Visit /login and /register pages, forms render correctly, registration creates user, login authenticates</verify>
  <done>Login and register pages work end-to-end. Users can create accounts and log in.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] /api/auth/register creates users with hashed passwords
- [ ] /register page creates account and redirects to home
- [ ] /login page authenticates and redirects to home
- [ ] Invalid credentials show error message
- [ ] Duplicate email registration returns 409
</verification>

<success_criteria>

- Registration endpoint creates users securely
- Login and register UI pages functional
- Form validation works (client and server)
- Error states displayed to user
- Successful auth redirects to home
</success_criteria>

<output>
After completion, create `.planning/phases/02-authentication/02-02-SUMMARY.md`
</output>
