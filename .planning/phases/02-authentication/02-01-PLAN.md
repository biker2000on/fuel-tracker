---
phase: 02-authentication
plan: 01
type: execute
depends_on: []
files_modified: [src/auth.ts, src/app/api/auth/[...nextauth]/route.ts, prisma/schema.prisma, .env]
---

<objective>
Set up Auth.js v5 with credentials provider and extend User model for authentication.

Purpose: Establish the authentication foundation with secure password storage.
Output: Auth.js configured with credentials provider, User model extended with passwordHash.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./02-01-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-02-SUMMARY.md
@prisma/schema.prisma
@src/lib/db.ts

**Tech stack available:**
- Next.js 16+ with App Router
- Prisma 7.x with PrismaPg adapter
- PostgreSQL via Docker

**Constraining decisions:**
- Phase 1: Prisma client at @/generated/prisma/client
- Phase 1: Singleton pattern in src/lib/db.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install and configure Auth.js v5 with credentials provider</name>
  <files>src/auth.ts, src/app/api/auth/[...nextauth]/route.ts, .env</files>
  <action>
    Install Auth.js: `npm install next-auth@beta bcrypt @types/bcrypt`

    Create src/auth.ts with Auth.js configuration:
    - Use CredentialsProvider for email/password auth
    - Configure JWT session strategy (not database sessions - simpler for self-hosted)
    - Set session maxAge to 30 days
    - Add callbacks for jwt and session to include user id
    - Use AUTH_SECRET env var (generate with `openssl rand -base64 32`)

    Create src/app/api/auth/[...nextauth]/route.ts:
    - Export GET and POST handlers from auth.ts
    - This enables /api/auth/* routes

    Update .env with AUTH_SECRET placeholder.
    Update .env.example with AUTH_SECRET template.

    Note: Do NOT use @auth/prisma-adapter - we're using JWT sessions, not database sessions.
    The credentials provider will query User directly via prisma client.
  </action>
  <verify>npm run build succeeds, /api/auth/providers endpoint returns JSON with credentials provider</verify>
  <done>Auth.js installed, auth.ts exports config, API route created, AUTH_SECRET in env.</done>
</task>

<task type="auto">
  <name>Task 2: Extend User model with passwordHash for credential auth</name>
  <files>prisma/schema.prisma</files>
  <action>
    Update User model in prisma/schema.prisma:

    ```prisma
    model User {
      id           String   @id @default(cuid())
      email        String   @unique
      passwordHash String
      name         String?
      createdAt    DateTime @default(now())
      updatedAt    DateTime @updatedAt
    }
    ```

    Key changes:
    - Add passwordHash field (required String) - stores bcrypt hash
    - Keep existing fields (id, email, name, createdAt, updatedAt)

    Run `npx prisma generate` to update types.

    Note: We do NOT need Session or Account models because we're using JWT strategy.
    Auth.js handles sessions in JWT tokens, not database tables.
  </action>
  <verify>npx prisma validate passes, npx prisma generate succeeds, User type includes passwordHash</verify>
  <done>User model has passwordHash field, Prisma types regenerated.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npx prisma validate` passes
- [ ] Auth.js config exports NextAuth handlers
- [ ] AUTH_SECRET in .env and .env.example
- [ ] No TypeScript errors
</verification>

<success_criteria>

- Auth.js v5 installed and configured
- Credentials provider set up (not yet functional - needs registration)
- User model has passwordHash field
- JWT session strategy configured
- Ready for registration/login flows in 02-02
</success_criteria>

<output>
After completion, create `.planning/phases/02-authentication/02-01-SUMMARY.md`
</output>
