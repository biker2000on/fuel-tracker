---
phase: 08-csv-import
plan: 02
type: execute
depends_on: ["08-01"]
files_modified: [src/app/import/page.tsx, src/components/CsvPreview.tsx]
---

<objective>
Create CSV import UI with file upload, preview, and import execution.

Purpose: Provide user-friendly interface for importing historical fillup records.
Output: /import page with CSV upload, data preview, vehicle selection, and import button.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-csv-import/08-01-SUMMARY.md
@src/app/api/import/route.ts
@src/app/fillups/new/page.tsx

**Tech stack available:** Next.js 16, React 19, Tailwind 4
**Established patterns:** Dark theme (#0f172a), mobile-first, form handling with useState
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CSV preview component</name>
  <files>src/components/CsvPreview.tsx</files>
  <action>
    Create client component for previewing CSV data:

    1. Props: { data: Record<string, string>[], maxRows?: number }
    2. Display as scrollable table (horizontal and vertical scroll)
    3. Show column headers from first row's keys
    4. Show first N rows (default 10) with "and X more rows" indicator
    5. Highlight rows with validation issues (red background)
    6. Style to match app theme (dark background, slate borders)
    7. Handle empty data gracefully

    Keep it simple - just a read-only preview table.
  </action>
  <verify>Component renders test data without errors</verify>
  <done>CsvPreview displays tabular data with proper styling and row count indicator</done>
</task>

<task type="auto">
  <name>Task 2: Create import page with full flow</name>
  <files>src/app/import/page.tsx</files>
  <action>
    Create "use client" page at /import:

    1. Protected route (redirect to /login if not authenticated)
    2. Fetch user's vehicles for dropdown selection

    3. File upload section:
       - Drag-and-drop area OR file input
       - Accept .csv files only
       - Read file contents with FileReader
       - Parse CSV client-side for preview using same parseCSV logic

    4. Preview section (after file selected):
       - Use CsvPreview component
       - Show row count
       - Show any parsing warnings

    5. Vehicle selection dropdown:
       - Required before import
       - Show all user's vehicles from all groups

    6. Import button:
       - Disabled until file + vehicle selected
       - Shows loading state during import
       - Calls POST /api/import with { vehicleId, csv }

    7. Results display:
       - Success: "Imported X fillups" with link to vehicle history
       - Error: Show validation errors with row numbers
       - Allow retry with same file

    8. Add link from vehicle detail page to import page (bonus if time)

    Style consistent with app: dark theme, green primary button, proper spacing.
  </action>
  <verify>Full flow works: upload CSV, select vehicle, import, see success/errors</verify>
  <done>Import page handles full import flow with preview, vehicle selection, and result feedback</done>
</task>

<task type="auto">
  <name>Task 3: Add navigation to import page</name>
  <files>src/components/BottomNav.tsx, src/app/vehicles/[id]/page.tsx</files>
  <action>
    1. Add "Import" link to vehicle detail page:
       - In the actions section near "Add Fillup" button
       - Link to /import?vehicleId={id} (pre-select vehicle)

    2. Update import page to handle vehicleId query param:
       - If ?vehicleId provided, pre-select that vehicle in dropdown

    Don't add to bottom nav (too niche for primary navigation).
  </action>
  <verify>Vehicle detail page has import link, clicking navigates with pre-selected vehicle</verify>
  <done>Import accessible from vehicle detail, query param pre-selects vehicle</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] /import page loads for authenticated users
- [ ] CSV file upload shows preview
- [ ] Vehicle dropdown populates correctly
- [ ] Import creates fillups and shows success
- [ ] Validation errors display with row numbers
- [ ] Vehicle detail page links to import
</verification>

<success_criteria>
- Users can upload CSV and preview data before import
- Vehicle selection required and pre-selectable via URL
- Import results clearly show success or detailed errors
- Navigation to import accessible from vehicle detail
- UI matches app theme and is mobile-friendly
</success_criteria>

<output>
After completion, create `.planning/phases/08-csv-import/08-02-SUMMARY.md`

This completes Phase 8 - CSV Import.
</output>
