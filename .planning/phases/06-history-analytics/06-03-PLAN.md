---
phase: 06-history-analytics
plan: 03
type: execute
depends_on: []
files_modified: [src/app/dashboard/page.tsx, src/app/api/dashboard/route.ts, src/app/page.tsx, src/components/AuthStatus.tsx]
---

<objective>
Create a dashboard showing recent fillups across all vehicles and MPG trends.

Purpose: After logging in, users need a quick overview of recent activity and fuel economy trends across their household vehicles.
Output: Dashboard page with recent activity feed and per-vehicle MPG summary.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@src/app/page.tsx
@src/app/api/fillups/route.ts
@src/components/AuthStatus.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create dashboard API endpoint</name>
  <files>src/app/api/dashboard/route.ts</files>
  <action>
    Create GET /api/dashboard that returns dashboard data for the authenticated user:

    ```typescript
    {
      recentFillups: Array<{
        id: string
        date: string
        gallons: number
        totalCost: number
        mpg: number | null
        vehicleId: string
        vehicleName: string
        city: string | null
        state: string | null
      }>  // Last 10 fillups across all vehicles
      vehicleSummaries: Array<{
        id: string
        name: string
        year: number
        make: string
        model: string
        photoUrl: string | null
        lastFillup: string | null  // ISO date
        averageMpg: number | null
        recentMpg: number | null   // last fillup's MPG
        totalFillups: number
      }>
      totals: {
        totalVehicles: number
        totalFillupsThisMonth: number
        totalSpentThisMonth: number
      }
    }
    ```

    Get all vehicles for user's groups, then aggregate fillup data. Use efficient queries:
    - Fillups ordered by date desc, limit 10
    - Per-vehicle aggregations in single query where possible

    Handle users with no groups/vehicles gracefully (return empty arrays).
  </action>
  <verify>
    curl /api/dashboard returns expected data structure
    - User with vehicles shows data
    - User with no vehicles returns empty arrays
    - Recent fillups includes vehicle name
  </verify>
  <done>Dashboard API returns recent activity and vehicle summaries</done>
</task>

<task type="auto">
  <name>Task 2: Create dashboard page</name>
  <files>src/app/dashboard/page.tsx</files>
  <action>
    Create /dashboard page with three sections:

    **Header section:**
    - Welcome message with user name
    - This month's summary: X fillups, $Y spent
    - Quick action button: "Log Fillup" (links to /fillups/new)

    **Recent Activity section:**
    - List of last 10 fillups as compact cards
    - Each card: date, vehicle name, gallons, cost, MPG (if available), location
    - Tapping card goes to that vehicle's fillup history
    - If no fillups: "No recent activity - log your first fillup!"

    **Vehicle Overview section:**
    - Grid of vehicle cards (2 columns on mobile, 3 on desktop)
    - Each card: photo thumbnail (or placeholder), name, recent MPG, avg MPG
    - Tapping card goes to vehicle detail page
    - Color-code MPG: green if above avg, red if below
    - If no vehicles: "No vehicles yet" with link to /vehicles/new

    Use existing Tailwind patterns. Protect route (redirect unauthenticated to /login).
  </action>
  <verify>
    - /dashboard loads and shows data
    - Recent fillups displayed correctly
    - Vehicle cards show MPG summaries
    - Quick action button works
    - Unauthenticated users redirected to login
  </verify>
  <done>Dashboard page shows recent activity and vehicle overview with proper navigation</done>
</task>

<task type="auto">
  <name>Task 3: Update home page to redirect authenticated users to dashboard</name>
  <files>src/app/page.tsx, src/components/AuthStatus.tsx</files>
  <action>
    Update home page behavior:
    - If user is authenticated, redirect to /dashboard (client-side redirect in useEffect)
    - If unauthenticated, show current landing page with login/register links

    Update AuthStatus component:
    - If authenticated, show "Go to Dashboard" button instead of current links
    - Keep the Groups/Vehicles/Fillups links or remove them (dashboard is the new hub)

    This makes dashboard the primary landing spot for logged-in users.
  </action>
  <verify>
    - Visit / while logged in -> redirects to /dashboard
    - Visit / while logged out -> shows landing page
    - AuthStatus shows appropriate state
  </verify>
  <done>Authenticated users land on dashboard, unauthenticated see landing page</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Dashboard API returns correct data
- [ ] Dashboard page renders all sections
- [ ] Home page redirects authenticated users
- [ ] Mobile layout works correctly
- [ ] No TypeScript errors
</verification>

<success_criteria>

- Dashboard API endpoint created
- Dashboard page shows recent fillups and vehicle summaries
- Home page redirects authenticated users to dashboard
- All navigation works correctly
- Phase 6 complete
</success_criteria>

<output>
After completion, create `.planning/phases/06-history-analytics/06-03-SUMMARY.md`
</output>
