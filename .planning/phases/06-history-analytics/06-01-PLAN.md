---
phase: 06-history-analytics
plan: 01
type: execute
depends_on: []
files_modified: [src/app/vehicles/[id]/fillups/page.tsx, src/app/api/fillups/route.ts]
---

<objective>
Enhance the per-vehicle fillup history view with pagination, date filtering, and improved data display.

Purpose: Make fillup history more useful for vehicles with many entries - users need to browse, filter, and find specific fillups.
Output: Enhanced history page with pagination and date range filtering.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@src/app/vehicles/[id]/fillups/page.tsx
@src/app/api/fillups/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add pagination to fillups API and UI</name>
  <files>src/app/api/fillups/route.ts, src/app/vehicles/[id]/fillups/page.tsx</files>
  <action>
    Modify GET /api/fillups to support cursor-based pagination:
    - Add `cursor` query param (fillup ID to start after)
    - Add `pageSize` param (default 20, max 100)
    - Return `{ fillups, nextCursor, hasMore }` instead of just `{ fillups }`

    Update the fillups page:
    - Add "Load More" button at bottom when hasMore is true
    - Update fetchFillups to append to existing list when loading more
    - Track loading state for pagination separately from initial load

    Keep existing limit param for backwards compatibility but prefer pageSize.
  </action>
  <verify>
    - Create 25+ test fillups for a vehicle
    - Initial load shows first 20
    - "Load More" appears and loads next batch
    - All fillups eventually loaded
  </verify>
  <done>Pagination works with cursor-based loading, UI shows Load More when more data exists</done>
</task>

<task type="auto">
  <name>Task 2: Add date range filtering</name>
  <files>src/app/api/fillups/route.ts, src/app/vehicles/[id]/fillups/page.tsx</files>
  <action>
    Modify GET /api/fillups:
    - Add `startDate` and `endDate` query params (ISO date strings)
    - Filter fillups where date >= startDate AND date <= endDate
    - Validate dates are valid ISO strings

    Update fillups page:
    - Add collapsible filter section with date inputs (type="date")
    - Quick filter buttons: "Last 30 days", "Last 90 days", "This year", "All time"
    - When filter changes, reset pagination and refetch
    - Show active filter in a pill/badge that can be cleared

    Use native date inputs for mobile-friendliness (no external datepicker library).
  </action>
  <verify>
    - Date range filtering works in API (test with curl)
    - UI date inputs filter results correctly
    - Quick filter buttons apply correct date ranges
    - Clear filter returns to all fillups
  </verify>
  <done>Date filtering works via API and UI, quick filters available, active filter displayed</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Pagination loads fillups in batches
- [ ] Date filtering restricts results correctly
- [ ] Quick filter buttons work as expected
- [ ] No TypeScript errors
</verification>

<success_criteria>

- Pagination implemented with cursor-based loading
- Date range filtering via API and UI
- Quick filter buttons for common ranges
- All existing functionality preserved
</success_criteria>

<output>
After completion, create `.planning/phases/06-history-analytics/06-01-SUMMARY.md`
</output>
