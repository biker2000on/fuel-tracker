---
phase: 14-fix-pwa-install
plan: 02
type: execute
wave: 2
depends_on: [14-01]
files_modified: [src/hooks/useInstallPrompt.ts, src/components/IOSInstallGuide.tsx, src/components/InstallButton.tsx]
autonomous: true

must_haves:
  truths:
    - "Install button is visible on iOS Safari when not installed"
    - "Install button shows instructional UI for iOS users"
    - "Native install prompt still works on supported browsers (Chrome/Android)"
  artifacts:
    - path: "src/hooks/useInstallPrompt.ts"
      provides: "Platform-aware install state"
    - path: "src/components/IOSInstallGuide.tsx"
      provides: "iOS manual install instructions"
    - path: "src/components/InstallButton.tsx"
      provides: "Multi-platform install UI"
  key_links:
    - from: "src/components/InstallButton.tsx"
      to: "src/hooks/useInstallPrompt.ts"
      via: "useInstallPrompt hook call"
    - from: "src/components/InstallButton.tsx"
      to: "src/components/IOSInstallGuide.tsx"
      via: "conditional rendering"
---

<objective>
Implement platform-aware installation logic that provides a tailored experience for both supported browsers (native prompt) and iOS/Safari (instructional UI).

Purpose: Fix the issue where iOS users see no installation option, ensuring 100% of users can install the app.
Output: Updated hook, new instruction component, and enhanced install button.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-fix-pwa-install/14-RESEARCH.md
@src/hooks/useInstallPrompt.ts
@src/components/InstallButton.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor useInstallPrompt hook</name>
  <files>src/hooks/useInstallPrompt.ts</files>
  <action>
    Update the `useInstallPrompt` hook to detect iOS and return platform-specific state:
    - Add detection for iOS: `const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;`
    - Update `UseInstallPromptReturn` interface to include `isIOS` and `platform` ('ios' | 'standard').
    - Update `canInstall` logic: `(deferredPrompt !== null || (isIOS && !isStandalone)) && !isInstalled`.
    - Ensure it correctly detects if the app is already running in standalone mode.
  </action>
  <verify>Check hook return values in dev tools console or via temporary logging.</verify>
  <done>Hook returns platform and isIOS state correctly.</done>
</task>

<task type="auto">
  <name>Task 2: Create IOSInstallGuide component</name>
  <files>src/components/IOSInstallGuide.tsx</files>
  <action>
    Create a new component `IOSInstallGuide` that provides clear instructions for iOS users:
    - Use Lucide icons (Share, PlusSquare/SquarePlus) or SVG equivalents to match the iOS system icons.
    - Instructions should be:
      1. Tap the **Share** button (box with upward arrow) in the browser toolbar.
      2. Scroll down and tap **Add to Home Screen**.
      3. Tap **Add** in the top right corner.
    - Style the component to look like an instructional card, consistent with the app's theme.
  </action>
  <verify>Render the component in a test page or within the Profile page to verify layout and styling.</verify>
  <done>Instructional UI for iOS exists and is styled.</done>
</task>

<task type="auto">
  <name>Task 3: Update InstallButton to handle iOS</name>
  <files>src/components/InstallButton.tsx</files>
  <action>
    Refactor `InstallButton.tsx` to use the updated hook and show the appropriate UI:
    - If `isIOS` and `!isInstalled`, show a button that, when clicked, toggles the visibility of the `IOSInstallGuide`.
    - If `canInstall` (standard), keep the existing native prompt logic.
    - Ensure the "Installed" state still shows correctly.
    - Add a "How to install" label or similar for the iOS version.
  </action>
  <verify>Test on an iOS device (or simulate user agent) to verify the button appears and shows the guide.</verify>
  <done>InstallButton provides platform-specific installation paths.</done>
</task>

</tasks>

<verification>
- Simulate iOS User Agent in Chrome DevTools and verify the "Install" button appears and shows instructions.
- Verify standard installation prompt still triggers on Android/Chrome (using simulated `beforeinstallprompt` if possible, or real device).
- Verify "Installed" state appears when `display-mode: standalone` is active.
</verification>

<success_criteria>
- `useInstallPrompt` accurately reports iOS status.
- iOS users see an "Install" option that provides manual instructions.
- Standard PWA users still get the native install prompt.
- App looks and feels like a native app on iOS after manual installation.
</success_criteria>

<output>
After completion, create `.planning/phases/14-fix-pwa-install/14-02-SUMMARY.md`
</output>
