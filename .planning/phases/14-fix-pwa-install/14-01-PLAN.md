---
phase: 14-fix-pwa-install
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/app/manifest.ts, src/app/layout.tsx, public/screenshots/mobile-dashboard.png, public/screenshots/desktop-history.png]
autonomous: true

must_haves:
  truths:
    - "Web app manifest contains 'id', 'description', and 'screenshots' fields"
    - "Root layout contains apple-touch-icon metadata"
    - "PWA meets Chrome's Rich Install UI criteria"
  artifacts:
    - path: "src/app/manifest.ts"
      provides: "Enhanced PWA manifest"
    - path: "src/app/layout.tsx"
      provides: "iOS-specific PWA metadata"
    - path: "public/screenshots/mobile-dashboard.png"
      provides: "Rich UI mobile screenshot"
    - path: "public/screenshots/desktop-history.png"
      provides: "Rich UI desktop screenshot"
  key_links:
    - from: "src/app/layout.tsx"
      to: "/manifest.webmanifest"
      via: "Next.js automatic linking"
---

<objective>
Enhance the PWA manifest and root layout metadata to support modern "Rich Install UI" on Android/Chrome and improve appearance on iOS.

Purpose: Provide a more native-like installation experience and ensure the app is discoverable and attractive on all platforms.
Output: Updated manifest, new screenshot placeholders, and enhanced iOS metadata.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-fix-pwa-install/14-RESEARCH.md
@src/app/manifest.ts
@src/app/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update manifest.ts for Rich Install UI</name>
  <files>src/app/manifest.ts</files>
  <action>
    Update the `manifest` function in `src/app/manifest.ts` to include:
    - `id`: 'fuel-tracker-pwa'
    - `description`: 'Track fuel consumption and vehicle efficiency across your family fleet.'
    - `screenshots`: An array containing two objects:
      1. Mobile: src='/screenshots/mobile-dashboard.png', sizes='1170x2532', type='image/png', form_factor='narrow', label='Fuel Tracker Dashboard'
      2. Desktop: src='/screenshots/desktop-history.png', sizes='2880x1800', type='image/png', form_factor='wide', label='Vehicle History and Analytics'
    
    Ensure existing fields (name, short_name, icons, etc.) are preserved.
  </action>
  <verify>Run `npm run build` or inspect manifest output in dev mode to ensure all fields are present.</verify>
  <done>Manifest contains id, description, and screenshots.</done>
</task>

<task type="auto">
  <name>Task 2: Create placeholder screenshots</name>
  <files>public/screenshots/mobile-dashboard.png, public/screenshots/desktop-history.png</files>
  <action>
    Create the `public/screenshots` directory if it doesn't exist.
    Create two placeholder PNG files at the specified paths. 
    Since these are just for satisfying the manifest requirement for now, they can be simple colored rectangles or basic mockups.
    
    You can use a small base64 string to write a valid 1x1 or small PNG if no other tool is available, or use a bash command if `convert` (ImageMagick) is present.
  </action>
  <verify>Check that the files exist and are valid images.</verify>
  <done>Screenshot files exist in public/screenshots/.</done>
</task>

<task type="auto">
  <name>Task 3: Update layout.tsx with iOS metadata</name>
  <files>src/app/layout.tsx</files>
  <action>
    Update the `metadata` object in `src/app/layout.tsx` to ensure robust iOS support:
    - Ensure `appleWebApp` is correctly configured (already present but verify).
    - Ensure `icons.apple` points to `/icons/apple-touch-icon.png`.
    - (Optional) Add `itunes` metadata if relevant, but primarily focus on the PWA aspects.
    
    Also verify the `viewport` configuration (already present).
  </action>
  <verify>Inspect the rendered &lt;head&gt; in the browser to confirm `apple-mobile-web-app-capable` and `apple-touch-icon` links are present.</verify>
  <done>Root layout contains required iOS PWA metadata.</done>
</task>

</tasks>

<verification>
- Inspect the generated manifest (e.g., at `/manifest.webmanifest`) and verify all new fields.
- Use Chrome DevTools Lighthouse or Application tab to check PWA installability criteria.
- Verify iOS meta tags in the source of the rendered page.
</verification>

<success_criteria>
- Manifest includes `id`, `description`, and `screenshots`.
- Mobile and desktop screenshots exist in the public directory.
- Root layout provides correct iOS PWA metadata.
</success_criteria>

<output>
After completion, create `.planning/phases/14-fix-pwa-install/14-01-SUMMARY.md`
</output>
